/*
 * RoundDown - v2.0.1
 *
 * A round countdown timer adapted from Countdown 360.
 *
 * RoundDown is copyright 2017,2018,2020 by Scottsdale Community College.
 * Sean Robinson <sean.robinson@scottsdalecc.edu>
 *
 * Forked from Countdown360 by John Schult
 * https://github.com/johnschult/jquery.countdown360
 *
 * SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
"use strict";var startAngle=-.5*Math.PI,fullCircle=1.5*Math.PI;$.widget("scottsdalecc.rounddown",{options:{autostart:!0,duration:1e4,fillStyle:"#8ac575",fontColor:"#477050",fontFamily:"sans-serif",fontSize:void 0,fontWeight:700,label:["second","seconds"],onTime:[],smooth:!1,strokeStyle:"#477050",strokeWidth:void 0,radius:15.5},_create:function(){void 0===this.options.fontSize&&(this.options.fontSize=this.options.radius/1.2),this.options.strokeWidth||(this.options.strokeWidth=this.options.radius/4),this._currTime=-1,this._interval=0,this._status="stopped",this._pausedTimeElapsed=null,this._timerInterval=1e3,this.options.smooth&&(this._timerInterval=16),null===this.options.duration&&(this.options.duration=1/0),this.options.width=2*(this.options.radius+this.options.strokeWidth),this.options.height=this.options.width,this.options.arcX=this.options.radius+this.options.strokeWidth,this.options.arcY=this.options.arcX;var t=this.getCanvas();this.options.pen=t[0].getContext("2d"),this.options.pen.lineWidth=this.options.strokeWidth,this.options.pen.strokeStyle=this.options.strokeStyle,this.options.pen.fillStyle=this.options.fillStyle,this.options.pen.textAlign="center",this.options.pen.textBaseline="middle",this.options.ariaText=t.children("span"),this.options.pen.clearRect(0,0,this.options.width,this.options.height)},_init:function(){this.draw(),this.options.autostart&&this.start()},draw:function(){var t=this.options,i=this.elapsedTime(),s=2*Math.PI*(1-i/t.duration)+startAngle,o=Math.ceil((t.duration-i)/1e3);t.pen.clearRect(0,0,t.width,t.height),this.drawCountdownShape(fullCircle,!1),this.drawCountdownLabel(o),t.onTime[o]&&o!==this._currTime&&(t.onTime[o](o),this._currTime=o),i<t.duration?this.drawCountdownShape(s,!0):"stopped"!==this._status&&(this.stop(),this._status="stopped")},drawCountdownLabel:function(t){var i=this.options,s=i.label&&i.label[1];1===t?s=i.label&&i.label[0]:t===1/0&&(t="âˆž");var o=i.width/2,e=i.height/2;i.ariaText.text(t),i.pen.font="".concat(i.fontWeight," ",i.fontSize,"px ",i.fontFamily),s&&(e-=i.fontSize/6.2),i.pen.fillStyle=i.fillStyle,i.pen.fillText(t+1,o,e),i.pen.fillStyle=i.fontColor,i.pen.fillText(t,o,e),s&&(i.pen.font="".concat("normal small-caps ",i.fontSize/3,"px ",i.fontFamily),i.pen.fillText(s,i.width/2,i.height/2+i.fontSize/2.2))},drawCountdownShape:function(t,i){var s=this.options;s.pen.fillStyle=s.fillStyle,s.pen.beginPath(),s.pen.arc(s.arcX,s.arcY,s.radius,startAngle,t,!1),i?s.pen.stroke():s.pen.fill()},elapsedTime:function(){return"started"===this._status?new Date-this.startedAt:"paused"===this._status?this._pausedTimeElapsed:0},getCanvas:function(){if(void 0!==this.options.pen&&void 0!==this.options.pen.canvas)return $(this.options.pen.canvas);var t="rounddown_"+Date.now().toString(36),i=$("<span></span>").attr({id:t+"_text",role:"status",ariaLive:"assertive"}),s=$("<canvas>").attr({id:t,height:this.options.height,width:this.options.width}).append(i);return this.element.prepend(s),s},pause:function(){"started"===this._status&&(this.stopTick(),this._pausedTimeElapsed=this.elapsedTime(),this._status="paused")},radius:function(t){if(void 0===t)return this.options.radius;var i=t/this.options.radius;this.options.radius=t,this.options.fontSize=this.options.fontSize*i,this.options.arcX=t+this.options.strokeWidth,this.options.arcY=this.options.arcX,this.options.width=2*(t+this.options.strokeWidth),this.options.height=this.options.width,this.options.pen.canvas.width=this.options.width,this.options.pen.canvas.height=this.options.height,this.options.pen.lineWidth=this.options.strokeWidth,this.options.pen.strokeStyle=this.options.strokeStyle,this.options.pen.fillStyle=this.options.fillStyle,this.options.pen.textAlign="center",this.options.pen.textBaseline="middle",this.draw()},remainingTime:function(){return this.options.duration-this.elapsedTime()},resume:function(){"paused"===this._status&&(this.startTick(),this.startedAt=new Date(new Date-this._pausedTimeElapsed),this._pausedTimeElapsed=null,this._status="started")},start:function(){"stopped"!==this._status&&this.stopTick(),this.drawCountdownShape(fullCircle,!0),this.drawCountdownLabel(this.options.duration/1e3),this.startTick(),this.startedAt=new Date,this._pausedTimeElapsed=null,this._currTime=-1,this._status="started"},startTick:function(){0===this._interval&&(this._interval=setInterval(this.draw.bind(this),this._timerInterval))},stop:function(){this.stopTick(),this._status="stopped"},stopTick:function(){0!=this._interval&&clearInterval(this._interval),this._interval=0}});
